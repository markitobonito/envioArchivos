<!DOCTYPE html>
<html lang="es">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Multicast File Sender</title>
   <script src="https://cdn.tailwindcss.com"></script>
   <style>
       body {
           font-family: "Inter", sans-serif;
       }
   </style>
</head>
<body class="bg-gradient-to-br from-blue-500 to-purple-600 min-h-screen flex items-center justify-center p-4">
   <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md">
       <h1 class="text-4xl font-extrabold text-center text-gray-900 mb-8">
           <span class="block">üöÄ Multicast File Sender</span>
       </h1>

       {% with messages = get_flashed_messages() %}
           {% if messages %}
               <ul class="mb-6 space-y-2">
                   {% for message in messages %}
                       <li class="p-3 rounded-lg text-sm {% if '√©xito' in message|lower or 'sent successfully' in message|lower %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %} flex items-center">
                           <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                               {% if '√©xito' in message|lower or 'sent successfully' in message|lower %}
                               <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                               {% else %}
                               <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                               {% endif %}
                           </svg>
                           {{ message }}
                       </li>
                   {% endfor %}
               </ul>
           {% endif %}
       {% endwith %}

       <form method="post" enctype="multipart/form-data" class="space-y-6" id="uploadForm">
           <div>
               <label for="file" class="block text-sm font-medium text-gray-700 mb-2">
                   Selecciona un archivo para enviar:
               </label>
               <input type="file" name="file" id="file" class="block w-full text-sm text-gray-900
                   border border-gray-300 rounded-lg cursor-pointer bg-gray-50
                   focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500
                   file:mr-4 file:py-2 file:px-4
                   file:rounded-full file:border-0
                   file:text-sm file:font-semibold
                   file:bg-blue-50 file:text-blue-700
                   hover:file:bg-blue-100"
               >
               <p class="mt-2 text-xs text-gray-500">Tama√±o m√°ximo del archivo: 16MB</p>
           </div>

           <!-- Campos ocultos para programaci√≥n de video -->
           <div id="videoSchedule" class="hidden bg-purple-50 p-4 rounded-lg border-2 border-purple-200 space-y-4">
               <h3 class="font-bold text-purple-900 flex items-center">
                   <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>
                   Programaci√≥n de Video
               </h3>

               <div class="space-y-3">
                   <label class="flex items-center cursor-pointer">
                       <input type="radio" name="videoAction" value="now" checked class="w-4 h-4 text-purple-600" onchange="toggleScheduleForm()">
                       <span class="ml-3 font-semibold text-purple-900">‚ñ∂ Reproducir Ahora</span>
                   </label>
                   <label class="flex items-center cursor-pointer">
                       <input type="radio" name="videoAction" value="schedule" class="w-4 h-4 text-purple-600" onchange="toggleScheduleForm()">
                       <span class="ml-3 font-semibold text-purple-900">‚è∞ Programar Reproducci√≥n</span>
                   </label>
                   <label class="flex items-center cursor-pointer">
                       <input type="radio" name="videoAction" value="silent" class="w-4 h-4 text-purple-600" onchange="toggleScheduleForm()">
                       <span class="ml-3 font-semibold text-purple-900">ü§ê Solo Descargar</span>
                   </label>
               </div>

               <!-- Formulario de programaci√≥n (oculto inicialmente) -->
               <div id="scheduleForm" class="hidden bg-white p-3 rounded border border-purple-300 space-y-3">
                   <div>
                       <label class="block text-sm font-medium text-gray-700 mb-1">Hora de Reproducci√≥n:</label>
                       <input type="time" name="videoTime" id="videoTime" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500">
                   </div>

                   <div>
                       <label class="block text-sm font-medium text-gray-700 mb-2">D√≠as de la Semana:</label>
                       <div class="grid grid-cols-2 gap-2">
                           <label class="flex items-center"><input type="checkbox" name="videoDays" value="monday" class="w-4 h-4"> <span class="ml-2 text-sm">Lunes</span></label>
                           <label class="flex items-center"><input type="checkbox" name="videoDays" value="tuesday" class="w-4 h-4"> <span class="ml-2 text-sm">Martes</span></label>
                           <label class="flex items-center"><input type="checkbox" name="videoDays" value="wednesday" class="w-4 h-4"> <span class="ml-2 text-sm">Mi√©rcoles</span></label>
                           <label class="flex items-center"><input type="checkbox" name="videoDays" value="thursday" class="w-4 h-4"> <span class="ml-2 text-sm">Jueves</span></label>
                           <label class="flex items-center"><input type="checkbox" name="videoDays" value="friday" class="w-4 h-4"> <span class="ml-2 text-sm">Viernes</span></label>
                           <label class="flex items-center"><input type="checkbox" name="videoDays" value="saturday" class="w-4 h-4"> <span class="ml-2 text-sm">S√°bado</span></label>
                           <label class="flex items-center col-span-2"><input type="checkbox" name="videoDays" value="sunday" class="w-4 h-4"> <span class="ml-2 text-sm">Domingo</span></label>
                       </div>
                   </div>
               </div>
           </div>

           <!-- Campo oculto para pasar datos de programaci√≥n -->
           <input type="hidden" name="videoAction" id="videoActionInput" value="now">
           <input type="hidden" name="videoTime" id="videoTimeInput" value="">
           <input type="hidden" name="videoDays" id="videoDaysInput" value="">

           <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-full
               shadow-sm text-lg font-bold text-white bg-blue-600
               hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2
               focus:ring-blue-500 transition duration-150 ease-in-out
               transform hover:scale-105 active:scale-95">
               Enviar Archivo
               <svg class="ml-2 -mr-1 w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                   <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l.44-1.101a1 1 0 01.95-1.166h7.676a1 1 0 01.95 1.166l.44 1.101a1 1 0 001.169-1.409l-7-14z"></path>
               </svg>
           </button>
       </form>

       <script>
           const fileInput = document.getElementById('file');
           const videoSchedule = document.getElementById('videoSchedule');
           const scheduleForm = document.getElementById('scheduleForm');
           const uploadForm = document.getElementById('uploadForm');

           // Mostrar opciones de programaci√≥n solo si es video
           fileInput.addEventListener('change', function() {
               const fileName = this.files[0]?.name.toLowerCase() || '';
               const isVideo = /\.(mp4|webm|mkv|avi|mov|flv|m4v|ts|m3u8)$/.test(fileName);
               videoSchedule.style.display = isVideo ? 'block' : 'none';
               if (!isVideo) {
                   document.querySelector('input[name="videoAction"][value="now"]').checked = false;
                   document.querySelector('input[name="videoAction"][value="schedule"]').checked = false;
                   document.querySelector('input[name="videoAction"][value="silent"]').checked = true;
               }
           });

           function toggleScheduleForm() {
               const action = document.querySelector('input[name="videoAction"]:checked').value;
               scheduleForm.style.display = action === 'schedule' ? 'block' : 'none';
               document.getElementById('videoActionInput').value = action;
           }

           // Recolectar datos antes de enviar
           uploadForm.addEventListener('submit', function(e) {
               const action = document.querySelector('input[name="videoAction"]:checked')?.value;
               document.getElementById('videoActionInput').value = action || 'silent';

               if (action === 'schedule') {
                   const time = document.getElementById('videoTime').value;
                   const days = Array.from(document.querySelectorAll('input[name="videoDays"]:checked')).map(cb => cb.value).join(',');
                   
                   if (!time || !days) {
                       e.preventDefault();
                       alert('Por favor selecciona hora y d√≠as para la programaci√≥n');
                       return;
                   }
                   
                   document.getElementById('videoTimeInput').value = time;
                   document.getElementById('videoDaysInput').value = days;
               }
           });
       </script>

       <p class="text-center text-gray-500 text-sm mt-8">
           Aseg√∫rate de que tu receptor multicast est√© activo y escuchando.
       </p>

       <div class="mt-6 pt-6 border-t border-gray-200">
           <a href="/videos" class="w-full flex justify-center py-3 px-4 border-2 border-purple-600 rounded-full
               text-lg font-bold text-purple-600 bg-white
               hover:bg-purple-50 transition duration-150 ease-in-out
               transform hover:scale-105 active:scale-95">
               üé¨ Ver Videos Recibidos
           </a>
       </div>
   </div>
</body>
</html>