# Minimal modern compose file (no `version` field)
services:
  quic-file-transfer:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8080:5000"  # Flask web server
      - "9999:9999/udp"  # QUIC server (UDP)
    volumes:
      - ./app:/app
      - ./certs:/certs
      - ./certs:/app/certs
      - ./app/uploads:/app/uploads
      - ${DOWNLOADS_PATH:-$HOME/Downloads}:/root/Downloads
      - /var/run/tailscale:/var/run/tailscale:ro
      - /var/lib/tailscale:/var/lib/tailscale:ro
    working_dir: /app
    environment:
      FLASK_APP: "run.py"
      TAILSCALE_AUTHKEY: "${TAILSCALE_AUTHKEY}"
      TAILSCALE_API_KEY: "${TAILSCALE_API_KEY}"
      TAILNET: "${TAILNET}"
    privileged: true
    cap_add:
      - NET_ADMIN
      - SYS_MODULE
    devices:
      - /dev/net/tun:/dev/net/tun
    restart: unless-stopped
    user: "0"
    command: "python3 /run.py"

networks:
  default:
    driver: bridge